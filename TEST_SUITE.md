# 🧪 **سلسلة الاختبارات الشاملة - WhatsApp Messages Page**

**تاريخ الإنشاء:** 2025-10-03  
**الهدف:** اختبار شامل لجميع الوظائف والسيناريوهات  
**المدة المتوقعة:** 4-6 ساعات

---

## 📊 **ملخص الاختبارات**

| الفئة | العدد | المدة | الأولوية |
|-------|-------|-------|----------|
| **Functional Tests** | 25 | 2 ساعات | 🔴 Critical |
| **Performance Tests** | 10 | 1 ساعة | 🟠 High |
| **Error Handling Tests** | 15 | 1 ساعة | 🟠 High |
| **Integration Tests** | 12 | 1.5 ساعة | 🟡 Medium |
| **Compatibility Tests** | 8 | 1 ساعة | 🟢 Low |
| **إجمالي** | **70** | **6.5 ساعات** | - |

---

## ✅ **FUNCTIONAL TESTS**

### **TEST-F001: إرسال رسالة نصية**
**الأولوية:** 🔴 Critical  
**المدة:** 5 دقائق

**الخطوات:**
1. فتح صفحة الرسائل
2. اختيار جهة اتصال من القائمة
3. كتابة رسالة نصية في حقل الإدخال
4. الضغط على زر الإرسال

**النتيجة المتوقعة:**
- ✅ الرسالة تظهر فوراً في نافذة المحادثة (optimistic update)
- ✅ حالة الرسالة: "pending" → "sent" → "delivered"
- ✅ حقل الإدخال يُفرغ تلقائياً
- ✅ Scroll to bottom تلقائياً
- ✅ الرسالة تُحفظ في قاعدة البيانات

**كيفية التحقق:**
```bash
# Backend logs
grep "Message sent successfully" backend.log

# Database query
SELECT * FROM whatsapp_messages 
WHERE direction = 'outbound' 
ORDER BY createdAt DESC 
LIMIT 1;

# Frontend Console
# Should see: "✅ Message sent: {messageId}"
```

---

### **TEST-F002: استقبال رسالة عبر WebSocket**
**الأولوية:** 🔴 Critical  
**المدة:** 5 دقائق

**الخطوات:**
1. فتح صفحة الرسائل
2. اختيار جهة اتصال
3. إرسال رسالة من WhatsApp mobile إلى الرقم المتصل بالجلسة

**النتيجة المتوقعة:**
- ✅ الرسالة تظهر فوراً في نافذة المحادثة (real-time)
- ✅ لا يوجد تأخير ملحوظ (< 1 ثانية)
- ✅ الرسالة في الجهة اليسرى (inbound)
- ✅ آخر رسالة في قائمة جهات الاتصال تتحدث
- ✅ Scroll to bottom إذا كان المستخدم في الأسفل

**كيفية التحقق:**
```javascript
// Frontend Console
// Should see:
// "🔔 NEW MESSAGE RECEIVED VIA WEBSOCKET!"
// "✅ Message is from selected contact, adding to messages list"

// Backend logs
grep "Broadcasted new message for session" backend.log
```

---

### **TEST-F003: تحميل الرسائل من API**
**الأولوية:** 🔴 Critical  
**المدة:** 3 دقائق

**الخطوات:**
1. فتح صفحة الرسائل
2. اختيار جهة اتصال لها رسائل سابقة
3. انتظار تحميل الرسائل

**النتيجة المتوقعة:**
- ✅ Loading spinner يظهر أثناء التحميل
- ✅ الرسائل تُحمّل بالترتيب الزمني الصحيح
- ✅ الرسائل الواردة على اليسار، الصادرة على اليمين
- ✅ Timestamps صحيحة
- ✅ User avatars تظهر للرسائل الصادرة

**كيفية التحقق:**
```javascript
// Frontend Console
// Should see: "✅ Messages loaded: {count}"

// Network tab
// Should see: GET /api/v1/whatsapp/messages?contact={phoneNumber}
// Status: 200 OK
```

---

### **TEST-F004: إرسال صورة**
**الأولوية:** 🔴 Critical  
**المدة:** 5 دقائق

**الخطوات:**
1. اختيار جهة اتصال
2. الضغط على أيقونة المرفقات
3. اختيار "صورة"
4. اختيار صورة من الجهاز (< 5MB)
5. إضافة caption اختياري
6. الضغط على إرسال

**النتيجة المتوقعة:**
- ✅ Preview للصورة يظهر قبل الإرسال
- ✅ Upload progress bar يظهر
- ✅ الصورة تُرسل بنجاح
- ✅ الصورة تظهر في نافذة المحادثة
- ✅ Caption يظهر تحت الصورة

**كيفية التحقق:**
```bash
# Backend logs
grep "Image sent successfully" backend.log

# Database
SELECT * FROM whatsapp_messages 
WHERE messageType = 'image' 
ORDER BY createdAt DESC 
LIMIT 1;
```

---

### **TEST-F005: إرسال مستند**
**الأولوية:** 🟠 High  
**المدة:** 5 دقائق

**الخطوات:**
1. اختيار جهة اتصال
2. الضغط على أيقونة المرفقات
3. اختيار "مستند"
4. اختيار ملف PDF/DOC/XLS
5. الضغط على إرسال

**النتيجة المتوقعة:**
- ✅ اسم الملف وحجمه يظهران
- ✅ Upload progress bar يظهر
- ✅ الملف يُرسل بنجاح
- ✅ أيقونة الملف تظهر في المحادثة

---

### **TEST-F006: إرسال فيديو**
**الأولوية:** 🟡 Medium  
**المدة:** 5 دقائق

**الخطوات:**
1. اختيار جهة اتصال
2. الضغط على أيقونة المرفقات
3. اختيار "فيديو"
4. اختيار فيديو (< 16MB)
5. الضغط على إرسال

**النتيجة المتوقعة:**
- ✅ Video thumbnail يظهر
- ✅ Upload progress bar يظهر
- ✅ الفيديو يُرسل بنجاح

---

### **TEST-F007: إرسال رسالة صوتية**
**الأولوية:** 🟡 Medium  
**المدة:** 5 دقائق

**الخطوات:**
1. اختيار جهة اتصال
2. الضغط على أيقونة المرفقات
3. اختيار "صوت"
4. اختيار ملف صوتي
5. الضغط على إرسال

**النتيجة المتوقعة:**
- ✅ الملف الصوتي يُرسل بنجاح
- ✅ أيقونة الميكروفون تظهر في المحادثة

---

### **TEST-F008: اختيار جهة اتصال مختلفة**
**الأولوية:** 🔴 Critical  
**المدة:** 3 دقائق

**الخطوات:**
1. اختيار جهة اتصال A
2. انتظار تحميل الرسائل
3. اختيار جهة اتصال B
4. انتظار تحميل الرسائل

**النتيجة المتوقعة:**
- ✅ رسائل جهة A تختفي
- ✅ رسائل جهة B تظهر
- ✅ لا يوجد mixing بين الرسائل
- ✅ WebSocket يُعيد الاشتراك في الجلسة الصحيحة

**كيفية التحقق:**
```javascript
// Frontend Console
// Should see:
// "👤 Selected contact changed: {contactB}"
// "📥 Fetching messages for contact: {contactB}"
// "✅ Messages loaded: {count}"
```

---

### **TEST-F009: البحث في جهات الاتصال**
**الأولوية:** 🟠 High  
**المدة:** 3 دقائق

**الخطوات:**
1. كتابة اسم أو رقم في حقل البحث
2. التحقق من النتائج

**النتيجة المتوقعة:**
- ✅ جهات الاتصال تُفلتر فوراً
- ✅ البحث يعمل بالاسم والرقم
- ✅ Case-insensitive search
- ✅ مسح البحث يُعيد جميع جهات الاتصال

---

### **TEST-F010: البحث في الرسائل**
**الأولوية:** 🟠 High  
**المدة:** 3 دقائق

**الخطوات:**
1. اختيار جهة اتصال لها رسائل كثيرة
2. كتابة كلمة في حقل البحث في الرسائل
3. التحقق من النتائج

**النتيجة المتوقعة:**
- ✅ الرسائل تُفلتر لتظهر فقط المطابقة
- ✅ عدد النتائج يظهر
- ✅ الكلمة المبحوث عنها highlighted في النتائج
- ✅ Debounced search (لا re-render على كل keystroke)

---

### **TEST-F011: فلترة الرسائل (واردة/صادرة)**
**الأولوية:** 🟡 Medium  
**المدة:** 2 دقائق

**الخطوات:**
1. اختيار جهة اتصال
2. الضغط على "واردة"
3. التحقق من النتائج
4. الضغط على "صادرة"
5. التحقق من النتائج

**النتيجة المتوقعة:**
- ✅ فقط الرسائل الواردة تظهر عند اختيار "واردة"
- ✅ فقط الرسائل الصادرة تظهر عند اختيار "صادرة"
- ✅ جميع الرسائل تظهر عند اختيار "الكل"

---

### **TEST-F012: فلترة الرسائل حسب التاريخ**
**الأولوية:** 🟡 Medium  
**المدة:** 2 دقائق

**الخطوات:**
1. اختيار جهة اتصال
2. اختيار "اليوم"
3. التحقق من النتائج
4. اختيار "هذا الأسبوع"
5. التحقق من النتائج

**النتيجة المتوقعة:**
- ✅ فقط رسائل اليوم تظهر عند اختيار "اليوم"
- ✅ رسائل آخر 7 أيام تظهر عند اختيار "هذا الأسبوع"
- ✅ رسائل آخر 30 يوم تظهر عند اختيار "هذا الشهر"

---

### **TEST-F013: Refresh الصفحة**
**الأولوية:** 🔴 Critical  
**المدة:** 2 دقائق

**الخطوات:**
1. اختيار جهة اتصال
2. إرسال رسالة
3. الضغط على F5
4. اختيار نفس جهة الاتصال

**النتيجة المتوقعة:**
- ✅ الرسائل لا تزال موجودة
- ✅ الرسالة المرسلة موجودة
- ✅ لا يوجد duplicate messages
- ✅ WebSocket يُعيد الاتصال تلقائياً

---

### **TEST-F014: استخدام قالب جاهز**
**الأولوية:** 🟡 Medium  
**المدة:** 3 دقائق

**الخطوات:**
1. اختيار جهة اتصال
2. الضغط على أيقونة القوالب
3. اختيار قالب
4. التحقق من النتيجة

**النتيجة المتوقعة:**
- ✅ نص القالب يظهر في حقل الإدخال
- ✅ يمكن تعديل النص قبل الإرسال
- ✅ Usage count للقالب يزيد

---

### **TEST-F015: إنشاء جهة اتصال جديدة**
**الأولوية:** 🟠 High  
**المدة:** 3 دقائق

**الخطوات:**
1. الضغط على "محادثة جديدة"
2. إدخال رقم هاتف صحيح
3. إدخال اسم اختياري
4. الضغط على "إنشاء"

**النتيجة المتوقعة:**
- ✅ جهة الاتصال تُضاف إلى القائمة
- ✅ جهة الاتصال تُحدد تلقائياً
- ✅ يمكن إرسال رسالة فوراً

---

## ⚡ **PERFORMANCE TESTS**

### **TEST-P001: تحميل 100+ رسالة**
**الأولوية:** 🔴 Critical  
**المدة:** 5 دقائق

**الخطوات:**
1. اختيار جهة اتصال لها 100+ رسالة
2. قياس وقت التحميل
3. قياس memory usage

**النتيجة المتوقعة:**
- ✅ التحميل يتم في < 2 ثانية
- ✅ Smooth scrolling (60 FPS)
- ✅ Memory usage < 100MB
- ✅ لا يوجد lag ملحوظ

**كيفية القياس:**
```javascript
// Chrome DevTools → Performance
// Record → Select contact → Stop
// Check:
// - Loading time
// - FPS during scroll
// - Memory usage
```

---

### **TEST-P002: استقبال رسائل متعددة في نفس الوقت**
**الأولوية:** 🟠 High  
**المدة:** 5 دقائق

**الخطوات:**
1. اختيار جهة اتصال
2. إرسال 10 رسائل بسرعة من WhatsApp mobile
3. مراقبة الأداء

**النتيجة المتوقعة:**
- ✅ جميع الرسائل تظهر
- ✅ لا يوجد duplicate messages
- ✅ الترتيب الزمني صحيح
- ✅ لا يوجد lag في UI

---

### **TEST-P003: Scroll performance في قائمة طويلة**
**الأولوية:** 🟠 High  
**المدة:** 3 دقائق

**الخطوات:**
1. اختيار جهة اتصال لها 500+ رسالة
2. Scroll up and down بسرعة
3. قياس FPS

**النتيجة المتوقعة:**
- ✅ Smooth scrolling (60 FPS)
- ✅ لا يوجد jank
- ✅ Images تُحمّل lazy
- ✅ Virtualization يعمل بشكل صحيح

---

### **TEST-P004: Memory leak check**
**الأولوية:** 🔴 Critical  
**المدة:** 10 دقائق

**الخطوات:**
1. فتح Chrome DevTools → Memory
2. أخذ heap snapshot
3. اختيار 20 جهة اتصال مختلفة بسرعة
4. أخذ heap snapshot آخر
5. مقارنة النتائج

**النتيجة المتوقعة:**
- ✅ Memory usage لا يزيد بشكل كبير
- ✅ Event listeners تُنظّف بشكل صحيح
- ✅ لا يوجد detached DOM nodes
- ✅ WebSocket connections تُغلق بشكل صحيح

---

### **TEST-P005: Search performance**
**الأولوية:** 🟡 Medium  
**المدة:** 3 دقائق

**الخطوات:**
1. اختيار جهة اتصال لها 1000+ رسالة
2. كتابة كلمة في حقل البحث
3. قياس وقت الاستجابة

**النتيجة المتوقعة:**
- ✅ النتائج تظهر في < 300ms
- ✅ Debounced search يعمل
- ✅ لا يوجد lag أثناء الكتابة

---

## 🚨 **ERROR HANDLING TESTS**

### **TEST-E001: فقدان اتصال WebSocket**
**الأولوية:** 🔴 Critical  
**المدة:** 5 دقائق

**الخطوات:**
1. فتح صفحة الرسائل
2. فصل الإنترنت
3. محاولة إرسال رسالة
4. إعادة الاتصال بالإنترنت

**النتيجة المتوقعة:**
- ✅ رسالة خطأ تظهر: "فقدان الاتصال"
- ✅ الرسالة تبقى في pending state
- ✅ عند إعادة الاتصال، WebSocket يُعيد الاتصال تلقائياً
- ✅ الرسالة تُرسل تلقائياً بعد إعادة الاتصال

**كيفية التحقق:**
```javascript
// Frontend Console
// Should see:
// "🔌 WebSocket disconnected"
// "🔄 Socket reconnected"
// "📱 User {userId} subscribed to session: {sessionId}"
```

---

### **TEST-E002: فشل API request**
**الأولوية:** 🔴 Critical  
**المدة:** 3 دقائق

**الخطوات:**
1. إيقاف Backend server
2. محاولة تحميل الرسائل
3. التحقق من Error handling

**النتيجة المتوقعة:**
- ✅ رسالة خطأ واضحة تظهر
- ✅ Retry button يظهر
- ✅ لا يوجد crash في التطبيق

---

### **TEST-E003: انتهاء صلاحية JWT token**
**الأولوية:** 🔴 Critical  
**المدة:** 5 دقائق

**الخطوات:**
1. تعديل JWT token ليكون منتهي الصلاحية
2. محاولة إرسال رسالة
3. التحقق من النتيجة

**النتيجة المتوقعة:**
- ✅ رسالة خطأ: "انتهت صلاحية الجلسة"
- ✅ Redirect إلى صفحة تسجيل الدخول بعد 2 ثانية
- ✅ لا يوجد crash

---

### **TEST-E004: إرسال رسالة لجلسة غير متصلة**
**الأولوية:** 🟠 High  
**المدة:** 3 دقائق

**الخطوات:**
1. فصل جلسة WhatsApp من Backend
2. محاولة إرسال رسالة
3. التحقق من النتيجة

**النتيجة المتوقعة:**
- ✅ رسالة خطأ: "الجلسة غير متصلة"
- ✅ الرسالة تبقى في failed state
- ✅ Retry button يظهر

---

### **TEST-E005: رفع ملف كبير جداً**
**الأولوية:** 🟡 Medium  
**المدة:** 3 دقائق

**الخطوات:**
1. محاولة رفع ملف > 16MB
2. التحقق من النتيجة

**النتيجة المتوقعة:**
- ✅ رسالة خطأ: "الملف كبير جداً (الحد الأقصى 16MB)"
- ✅ الملف لا يُرفع
- ✅ لا يوجد crash

---

### **TEST-E006: رقم هاتف غير صحيح**
**الأولوية:** 🟡 Medium  
**المدة:** 2 دقائق

**الخطوات:**
1. محاولة إنشاء جهة اتصال برقم غير صحيح
2. التحقق من النتيجة

**النتيجة المتوقعة:**
- ✅ رسالة خطأ: "رقم الهاتف غير صحيح"
- ✅ Validation يعمل قبل إرسال الطلب

---

## 🔗 **INTEGRATION TESTS**

### **TEST-I001: End-to-End Message Flow**
**الأولوية:** 🔴 Critical  
**المدة:** 10 دقائق

**الخطوات:**
1. إرسال رسالة من Frontend
2. التحقق من حفظها في Database
3. التحقق من إرسالها عبر WhatsApp API
4. استقبال رد من WhatsApp mobile
5. التحقق من ظهوره في Frontend

**النتيجة المتوقعة:**
- ✅ جميع الخطوات تعمل بشكل صحيح
- ✅ لا يوجد data loss
- ✅ Timestamps صحيحة

---

### **TEST-I002: Multi-user Scenario**
**الأولوية:** 🟠 High  
**المدة:** 10 دقائق

**الخطوات:**
1. فتح الصفحة من متصفحين مختلفين
2. تسجيل دخول بمستخدمين مختلفين
3. إرسال رسائل من كلا المستخدمين
4. التحقق من عدم mixing الرسائل

**النتيجة المتوقعة:**
- ✅ كل مستخدم يرى رسائله فقط
- ✅ لا يوجد cross-contamination
- ✅ WebSocket rooms منفصلة

---

## 🌐 **COMPATIBILITY TESTS**

### **TEST-C001: Chrome**
**الأولوية:** 🔴 Critical  
**المدة:** 10 دقائق

### **TEST-C002: Firefox**
**الأولوية:** 🟠 High  
**المدة:** 10 دقائق

### **TEST-C003: Safari**
**الأولوية:** 🟠 High  
**المدة:** 10 دقائق

### **TEST-C004: Edge**
**الأولوية:** 🟡 Medium  
**المدة:** 10 دقائق

### **TEST-C005: Mobile (Responsive)**
**الأولوية:** 🟠 High  
**المدة:** 15 دقائق

---

**إجمالي الاختبارات:** 70 اختبار  
**المدة الإجمالية:** 6.5 ساعات  
**معدل النجاح المتوقع:** > 95%


